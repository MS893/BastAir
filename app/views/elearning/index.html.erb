<% content_for :title, "Cours Théoriques" %>

<div class="container my-5">
  <h1 class="text-center mb-4">Formations théoriques de proximité</h1>
  <p class="lead text-center mb-5">
    Bienvenue dans votre espace de formation théorique. Retrouvez ici tous les cours nécessaires à votre apprentissage.
  </p>

  <% if @courses.any? %>
    <div class="row">
      <% @courses.each do |course| %>
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <h5 class="card-title text-info mb-4"><%= course.title %></h5>
                <%# On récupère l'entrée du livret préchargée depuis le contrôleur %>
                <% livret_entry = @user_livrets[course.id] %>
              </div>
              <%= simple_format(course.description) %>
              <%= link_to "Accéder au cours", elearning_path(course), class: "btn btn-outline-primary mt-3" %>
                <%# Si l'entrée existe, que le statut est 'validé' (3) et qu'une image de signature est attachée %>
                <% if livret_entry&.status == 3 %>
                  <%= link_to signature_livret_path(livret_entry), class: "text-decoration-none" do %>
                    <span class="badge bg-success ms-2 fw-normal">
                      <i class="bi bi-check-circle me-1"></i> Validé le <%= l(livret_entry.updated_at, format: :short_year) %>
                    </span>
                  <% end %>
                <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="alert alert-info text-center" role="alert">
      Aucun cours théorique n'est disponible pour le moment. Revenez bientôt !
    </div>
  <% end %>

  <hr class="my-5">

  <h2 class="text-center mb-4">Podcasts à écouter</h2>
  <p class="lead text-center mb-5">
    Découvrez nos podcasts pour approfondir vos connaissances théoriques où que vous soyez.
  </p>

  <% if @audios.any? %>
    <div class="row">
      <% @audios.each do |audio| %>
        <%= render 'podcast_card', audio: audio %>
      <% end %>
    </div>
  <% else %>
    <div class="alert alert-info text-center" role="alert">
      Aucun podcast n'est disponible pour le moment. Cette section sera bientôt enrichie !
    </div>
  <% end %>
  
</div>
