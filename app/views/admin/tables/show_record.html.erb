<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Détail de l'enregistrement #<%= @record.id %></h1>
    <div>
      <% if @table_name == 'transactions' %>
        <% if current_user.tresorier? %>
          <%= link_to 'Modifier', admin_edit_table_record_path(table_name: @table_name, id: @record.id), class: 'btn btn-primary me-2' %>
          <%= link_to 'Supprimer', admin_table_record_path(table_name: @table_name, id: @record.id),
              data: { turbo_method: :delete,
                      turbo_confirm: "Êtes-vous sûr de vouloir supprimer cette transaction ?\n\nCette action est irréversible et sera enregistrée." },
              class: 'btn btn-danger me-2' %>
        <% else %>
          <p>Seul le trésorier peut modifier ou supprimer une écriture comptable.</p>
        <% end %>
      <% else %>
        <%= link_to 'Modifier', admin_edit_table_record_path(table_name: @table_name, id: @record.id), class: 'btn btn-primary me-2' %>
        <%= link_to 'Supprimer', admin_table_record_path(table_name: @table_name, id: @record.id), data: { turbo_method: :delete, turbo_confirm: 'Êtes-vous sûr de vouloir supprimer cet enregistrement ?' }, class: 'btn btn-danger me-2' %>
      <% end %>
      <%= link_to 'Retour à la liste', admin_tables_path(table_name: @table_name), class: 'btn btn-secondary' %>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <dl class="row">
        <% @record.attributes.each do |attr_name, attr_value| %>
          <dt class="col-sm-3"><%= attr_name.humanize %></dt>
          <dd class="col-sm-9 mb-3">
            <% if @associated_records.key?(attr_name) && (associated_record = @associated_records[attr_name]) %>
              <%# Cas spécial pour afficher un lien vers l'utilisateur associé %>
              <% if associated_record.is_a?(User) %>
                <p><%= "#{associated_record.prenom} #{associated_record.nom}" %></p>
              <% else %>
                <%# Affiche un attribut pertinent de l'enregistrement associé s'il en a un %>
                <%= associated_record.try(:name) || associated_record.try(:title) || "Enregistrement ##{attr_value}" %>
              <% end %>
            <% elsif attr_name.end_with?('_id') && attr_value.present? %>
              <%# Si la clé étrangère n'a pas pu être résolue, on affiche juste l'ID %>
              <p>ID: <%= attr_value %></p>
            <% else %>
              <%# Affichage normal pour les autres attributs %>
              <% if attr_value.is_a?(Date) || attr_value.is_a?(Time) || attr_value.is_a?(ActiveSupport::TimeWithZone) %>
                <p><%= l(attr_value, format: :long) %></p>
              <% else %>
                <p><%= attr_value.presence || 'N/A' %></p>
              <% end %>
            <% end %>
          </dd>
        <% end %>
      </dl>
    </div>
  </div>
</div>
