<% content_for :title, "Mes Vols" %>

<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">Mon carnet de vol</h1>
    <%= link_to "Enregistrer un nouveau vol", new_vol_path, class: "btn btn-primary" %>
  </div>

  <% if @vols.any? %>
    <div class="table-responsive">
      <table class="table table-striped table-hover table-bordered text-center">
        <thead class="table-light">
          <tr>
            <th rowspan="2" class="align-middle">Date</th>
            <th colspan="2">Aérodrome</th>
            <th rowspan="2" class="align-middle">Aéronef</th>
            <th rowspan="2" class="align-middle">Temps de vol</th>
            <th rowspan="2" class="align-middle">Nom du CdB</th>
            <th colspan="3">Fonction</th>
            <th colspan="2">Condition opérationnelle</th>
            <th colspan="2">Atterrissages</th>
            <th rowspan="2" class="align-middle">Remarques</th>
          </tr>
          <tr>
            <th>Départ</th>
            <th>Arrivée</th>
            <th>CdB</th>
            <th>Double</th>
            <th>Instruction</th>
            <th>Nuit</th>
            <th>IFR</th>
            <th>Jour</th>
            <th>Nuit</th>
          </tr>
        </thead>
        <tbody>
          <% @vols.each do |vol| %>
            <tr>
              <td><%= l vol.debut_vol.to_date, format: :short_year if vol.debut_vol %></td>
              <td>
                <%= vol.depart %><br>
                <small class="text-muted"><%= l vol.debut_vol, format: :short_time if vol.debut_vol %></small>
              </td>
              <td>
                <%= vol.arrivee %><br>
                <small class="text-muted"><%= l vol.fin_vol, format: :short_time if vol.fin_vol %></small>
              </td>
              <td>
                <%= vol.type_vol %><br>
                <small class="text-muted"><%= vol.avion.immatriculation %></small>
              </td>
              <td><%= '%.2f' % vol.duree_vol %></td>
              <td>
                <% if !vol.solo? && vol.instructeur.present? %>
                  <%= vol.instructeur.name %>
                <% else %>
                  <%= vol.user.name %>
                <% end %>
              </td>
              <%# Colonne CdB : vol solo OU vol d'instruction pour l'instructeur %>
              <td><%= '%.2f' % vol.duree_vol if vol.instructeur_id.nil? || vol.type_vol == 'Instruction' %></td>
              <%# Colonne Double : vol avec instructeur, mais qui n'est pas le vol miroir de l'instructeur %>
              <td><%= '%.2f' % vol.duree_vol if vol.instructeur_id.present? && vol.type_vol != 'Instruction' %></td>
              <%# Colonne Instruction : vol en double commande pour un instructeur %>
              <td><%= '%.2f' % vol.duree_vol if @user.instructeur? && vol.type_vol == 'Instruction' %></td>
              <%# Colonne Nuit pour les conditions opérationnelles %>
              <td><%= '%.2f' % vol.duree_vol if vol.nature == 'VFR de nuit' %></td>
              <%# Colonne IFR pour les conditions opérationnelles %>
              <td><%= '%.2f' % vol.duree_vol if vol.nature == 'IFR' %></td>
              <td><%= vol.nb_atterro if vol.nature == 'VFR de jour' %></td>
              <td><%= vol.nb_atterro if vol.nature == 'VFR de nuit' %></td>
              <%# Affiche le type de vol dans les remarques, sauf si c'est "Standard" %>
              <td><%= vol.type_vol unless vol.type_vol == 'Standard' %></td>
            </tr>
          <% end %>
        </tbody>
        <tfoot class="table-group-divider">
          <tr class="fw-bold">
            <td colspan="4" class="text-end">Totaux</td>
            <td><%= '%.2f' % @total_duree_vol %></td>
            <td><%# Colonne Nom du CdB vide %></td>
            <td><%= '%.2f' % @total_heures_cdb %></td>
            <td><%= '%.2f' % @total_heures_double %></td>
            <td><%# Total Instruction (logique à définir si besoin) %></td>
            <td><%= '%.2f' % @total_heures_nuit %></td>
            <td><%= '%.2f' % @total_heures_ifr %></td>
            <td><%= @total_atterrissages_jour %></td>
            <td><%= @total_atterrissages_nuit %></td>
            <td><%# Colonne Remarques vide %></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="d-flex justify-content-center mt-4">
      <%= paginate @vols %>
    </div>
  <% else %>
    <p class="text-center text-muted">Vous n'avez encore enregistré aucun vol.</p>
  <% end %>
</div>
